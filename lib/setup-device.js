var async=require("async"),Table=require("easy-table"),novacom=require("./novacom");
(function(){function g(d,c){return c&&"function"===typeof c?d?setImmediate(c,null,d):setImmediate(c):d}function h(d,c){var k=[],a=new novacom.Resolver;async.waterfall([a.load.bind(a),a.list.bind(a),function(e,a){Array.isArray(e)&&e.forEach(function(b){var e,a,c=b.conn.concat([]);e=b.username&&b.host&&b.port?b.username+"@"+b.host+":"+b.port:b.id;a={profile:b.profile,name:b.name,deviceinfo:{},connection:b.conn||["ssh"],details:{platform:b.type}};1===c.length&&-1!==c.indexOf("novacom")?(a.deviceinfo.uid=
b.id,a.details.type=b.name.slice(0,3)):(a.deviceinfo={ip:b.host,port:String(b.port),user:b.username},a.details.password=b.password,a.details.privatekey=b.privateKeyName,a.details.passphrase=b.passphrase,a.details.description=b.description);b.id&&(a.deviceinfo.uid=b.id,a.details.type=b.name.slice(0,3));k.push("full"===d?a:{name:b.name,info:e,connection:b.conn||"ssh",profile:b.profile})});a(k)}],function(a){g(a,c)})}var f={};"undefined"!==typeof module&&module.exports&&(module.exports=f);f.showDeviceListAndExit=
function(d,c){d=d||"list";async.waterfall([h.bind(this,d),function(c,a){if("full"===d)console.log(JSON.stringify(c,null,4));else{var e=new Table;c.forEach(function(a){e.cell("name",a.name);e.cell("deviceinfo",a.info);e.cell("connection",a.connection);e.cell("profile",a.profile);e.newRow()});console.log(e.toString())}a()}],function(c){process.exit(0)})};f.showDeviceList=function(d){async.waterfall([h.bind(this,"list"),function(c,d){var a=new Table;c.forEach(function(c){a.cell("name",c.name);a.cell("deviceinfo",
c.info);a.cell("connection",c.connection);a.cell("profile",c.profile);a.newRow()});console.log(a.toString());d()}],function(c){g(c,d)})}})();
